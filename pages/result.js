import Head from "next/head"
import { Container, Table } from "react-bootstrap"
import RaceResultTable from "../components/RaceResultTable"
import ResultReposiotry from "../repository/ResultReposiotry"

export async function getServerSideProps(context) {
    const horses = await ResultReposiotry.fetchResult(context.query.raceId)
    const maxResult = horses.reduce((max,now) => Math.max(max,now.raceResults.length),0)
    return {
        props: {
            maxResult: maxResult,
            horses: horses
        }
    }
}

export default function Home(props) {
    return(
        <dev>
            <Head>
                <title>Umaaaaaa</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
                <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"></link>
            </Head>


            <main>
                <Container>
                    <Table>
                        <thead>
                            <tr>
                                <th>枠</th>
                                <th>馬名</th>
                                {[...Array(props.maxResult).keys()].map(
                                    (index) => (<th>{index+1}走前</th>)
                                )}
                            </tr>
                        </thead>
                        {props.horses.map((horse) => <RaceResultTable horse={horse} />)}
                    </Table>
                </Container>
            </main>
        </dev>
    )
}